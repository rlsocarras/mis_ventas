<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista Lista -->
    <record id="deuda_list_view" model="ir.ui.view">
        <field name="name">ventas.deuda.list</field>
        <field name="model">ventas.deuda</field>
        <field name="arch" type="xml">
            <list>
                <field name="viaje_id"/>
                <field name="persona_id"/>
                <field name="viaje_producto_id"/>
                <field name="cantidad"/>
                <field name="monto_total" sum="Monto Total"/>
                <field name="monto_pendiente" sum="Monto Pendiente"/>
                <field name="total_pagado" sum="Monto Pagado"/>
                <field name="estado" widget="badge"
                       decoration-success="estado=='pagado'"
                       decoration-warning="estado=='parcial'"
                       decoration-danger="estado == 'pendiente' or estado == 'vencida'"/>
                <field name="fecha_estimada_pago"/>
                <field name="dias_vencimiento"/>
                <button 
                    name="action_registrar_pago" 
                    type="object" 
                    string="Pagar"
                    class="btn-primary"
                    icon="fa-money"
                    invisible="monto_pendiente &lt;= 0"
                />
            </list>
        </field>
    </record>
    <!-- Vista Formulario -->
    <record id="deuda_form_view" model="ir.ui.view">
        <field name="name">ventas.deuda.form</field>
        <field name="model">ventas.deuda</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button 
                        name="action_registrar_pago" 
                        type="object" 
                        string="Registrar Pago"
                        class="btn-primary"
                        invisible="monto_pendiente &lt;= 0"
                    />
                    <field name="estado" widget="statusbar" 
                           statusbar_visible="pendiente,parcial,pagado,vencida"/>
                </header>
                <sheet>
                    <group>
                        <field name="viaje_id" />
                    </group>
                    <group>
                        <group>
                            <field name="persona_id"/>
                            <field name="cantidad"/>
                            <field name="total_pagado" widget="monetary" readonly="1"/>
                            
                        </group>
                        <group>
                            <field name="viaje_producto_id" />
                            <field name="fecha_estimada_pago"/>
                            <field name="monto_total" widget="monetary" readonly="1"/>
                            
                            <field name="monto_pendiente" widget="monetary" readonly="1"/>
                        </group>
                        <field name="fecha_creacion" readonly="1"/>
                    </group>
                    <notebook>
                        <page string="Pagos">
                            <field name="pagos_ids">
                                <list>
                                    <field name="fecha_pago"/>
                                    <field name="monto" widget="monetary"/>
                                    <field name="tipo_pago"/>
                                </list>
                            </field>
                        </page>
                        <page string="Información">
                            <!-- CORRECCIÓN: Sin t-if, usar invisible con condiciones -->
                            <div class="alert alert-info" invisible="estado != 'pendiente'">
                                <strong>Deuda Pendiente:</strong> Aún no se han realizado pagos.
                            </div>
                            <div class="alert alert-warning" invisible="estado != 'parcial'">
                                <strong>Pago Parcial:</strong> Se ha pagado parte de la deuda.
                            </div>
                            <div class="alert alert-success" invisible="estado != 'pagado'">
                                <strong>¡Deuda Pagada!</strong> Esta deuda ha sido completamente saldada.
                            </div>
                            <div class="alert alert-danger" invisible="estado != 'vencida'">
                                <strong>Deuda Vencida:</strong> La fecha estimada de pago ha pasado.
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <!-- Búsqueda -->
    <record id="deuda_search_view" model="ir.ui.view">
        <field name="name">ventas.deuda.search</field>
        <field name="model">ventas.deuda</field>
        <field name="arch" type="xml">
            <search>
                <!-- Panel de busqueda -->
                <searchpanel>
                    <field name="viaje_id"  string="Viajes" icon="fa-building" enable_counters="1" select="multi"/>
                    <field name="persona_id" string="Personas" icon='fa-user' enable_counters="1"/>
                    <field name="estado" string="Estado" icon='fa-state' enable_counters="1" select="multi"/>
                    <field name="viaje_producto_id" string="Producto" icon='fa-product' enable_counters="1"/>
                </searchpanel>
                <field name="persona_id"/>
                <field name="viaje_id"/>
                <field name="estado"/>
                <filter name="filter_pendientes" string="Pendientes" 
                        domain="[('estado', 'in', ['pendiente', 'vencida'])]"/>
                <filter name="filter_parciales" string="Parciales" 
                        domain="[('estado', '=', 'parcial')]"/>
                <filter name="filter_pagadas" string="Pagadas" 
                        domain="[('estado', '=', 'pagado')]"/>
                <filter name="filter_vencidas" string="Vencidas" 
                        domain="[('estado', '=', 'vencida')]"/>
            </search>
        </field>
    </record>
    <!-- Acción -->
    <record id="action_deuda" model="ir.actions.act_window">
        <field name="name">Deudas</field>
        <field name="res_model">ventas.deuda</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="deuda_search_view"/>
    </record>
</odoo>